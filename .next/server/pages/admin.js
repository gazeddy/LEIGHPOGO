(()=>{var a={};a.id=690,a.ids=[220,636,690],a.modules={361:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},2015:a=>{"use strict";a.exports=require("react")},2326:a=>{"use strict";a.exports=require("react-dom")},2604:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>o,getServerSideProps:()=>p});var e=c(8732),f=c(7085),g=c.n(f),h=c(5806),i=c(4722),j=c(2015),k=c(9968),l=c.n(k),m=c(4604),n=a([m]);function o({users:a,entries:b,searchStrings:c}){let{data:d,status:f}=(0,i.useSession)(),[h,k]=(0,j.useState)(b),[l,m]=(0,j.useState)(null),[n,o]=(0,j.useState)({trainerName:"",friendCode:""}),[p,q]=(0,j.useState)({}),[r,s]=(0,j.useState)("entries"),t=(0,j.useMemo)(()=>({entries:h.length,users:a.length,searches:c.length}),[h.length,a.length,c.length]);if("loading"===f)return(0,e.jsx)("p",{children:"Loading..."});if(!d||"admin"!==d.user.role)return(0,e.jsx)("p",{children:"Access denied"});let u=async(a,b)=>{await fetch(`/api/admin/users/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:b})}),location.reload()},v=async a=>{let b=p[a]??"";return b.length<8?void alert("Password must be at least 8 characters long"):(await fetch(`/api/admin/users/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:b})})).ok?void(alert("Password updated"),q(b=>({...b,[a]:""}))):void alert("Failed to reset password")},w=async a=>{confirm("Are you sure you want to delete this user?")&&(await fetch(`/api/admin/users/${a}`,{method:"DELETE"}),location.reload())},x=()=>{m(null),o({trainerName:"",friendCode:""})},y=async a=>{let b=await fetch(`/api/admin/entries/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!b.ok)return void alert("Failed to update entry");let c=await b.json();k(b=>b.map(b=>b.id===a?{...b,...c}:b)),x()},z=async a=>{if(confirm("Are you sure you want to delete this entry?")){if(!(await fetch(`/api/admin/entries/${a}`,{method:"DELETE"})).ok)return void alert("Failed to delete entry");k(b=>b.filter(b=>b.id!==a))}},A=({id:a,children:b})=>{let c=r===a;return(0,e.jsxs)("button",{type:"button",className:`admin-navbtn ${c?"active":""}`,onClick:()=>s(a),children:[(0,e.jsx)("span",{children:b}),(0,e.jsx)("span",{className:"admin-navbtn-caret",children:"▼"})]})};return(0,e.jsxs)("div",{className:"jsx-a188c1cc772d63e8 admin-wrap",children:[(0,e.jsx)("h1",{className:"jsx-a188c1cc772d63e8 admin-title",children:"Admin Panel"}),(0,e.jsxs)("div",{className:"jsx-a188c1cc772d63e8 admin-layout",children:[(0,e.jsxs)("aside",{className:"jsx-a188c1cc772d63e8 admin-sidebar",children:[(0,e.jsxs)(A,{id:"entries",className:"jsx-a188c1cc772d63e8",children:["Entries (",t.entries,")"]}),(0,e.jsxs)(A,{id:"users",className:"jsx-a188c1cc772d63e8",children:["Users (",t.users,")"]}),(0,e.jsxs)(A,{id:"searches",className:"jsx-a188c1cc772d63e8",children:["Saved search strings (",t.searches,")"]})]}),(0,e.jsxs)("main",{className:"jsx-a188c1cc772d63e8 admin-content",children:["entries"===r&&(0,e.jsxs)("section",{className:"jsx-a188c1cc772d63e8",children:[(0,e.jsx)("h2",{className:"jsx-a188c1cc772d63e8 admin-section-title",children:"Entries"}),(0,e.jsxs)("table",{className:"jsx-a188c1cc772d63e8 admin-table",children:[(0,e.jsx)("thead",{className:"jsx-a188c1cc772d63e8",children:(0,e.jsxs)("tr",{className:"jsx-a188c1cc772d63e8",children:[(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"ID"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"Trainer"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"Friend Code"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"Owner IGN"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"jsx-a188c1cc772d63e8",children:h.map(a=>(0,e.jsxs)("tr",{className:"jsx-a188c1cc772d63e8",children:[(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:a.id}),(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:l===a.id?(0,e.jsx)("input",{type:"text",value:n.trainerName,onChange:a=>o(b=>({...b,trainerName:a.target.value})),className:"jsx-a188c1cc772d63e8"}):a.trainerName}),(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:l===a.id?(0,e.jsx)("input",{type:"text",value:n.friendCode,onChange:a=>o(b=>({...b,friendCode:a.target.value})),className:"jsx-a188c1cc772d63e8"}):a.code}),(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:a.owner?.ign}),(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:l===a.id?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>y(a.id),className:"jsx-a188c1cc772d63e8",children:"Save"}),(0,e.jsx)("button",{onClick:x,className:"jsx-a188c1cc772d63e8",children:"Cancel"})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>{m(a.id),o({trainerName:a.trainerName,friendCode:a.code})},className:"jsx-a188c1cc772d63e8",children:"Edit"}),(0,e.jsx)("button",{onClick:()=>z(a.id),className:"jsx-a188c1cc772d63e8",children:"Delete"})]})})]},a.id))})]})]}),"users"===r&&(0,e.jsxs)("section",{className:"jsx-a188c1cc772d63e8",children:[(0,e.jsx)("h2",{className:"jsx-a188c1cc772d63e8 admin-section-title",children:"Users"}),(0,e.jsxs)("table",{className:"jsx-a188c1cc772d63e8 admin-table",children:[(0,e.jsx)("thead",{className:"jsx-a188c1cc772d63e8",children:(0,e.jsxs)("tr",{className:"jsx-a188c1cc772d63e8",children:[(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"ID"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"IGN"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"Role"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"Reset password"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"jsx-a188c1cc772d63e8",children:a.map(a=>(0,e.jsxs)("tr",{className:"jsx-a188c1cc772d63e8",children:[(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:a.id}),(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:a.ign}),(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:a.role}),(0,e.jsxs)("td",{className:"jsx-a188c1cc772d63e8",children:[(0,e.jsx)("input",{type:"password",placeholder:"New password",value:p[a.id]??"",onChange:b=>q(c=>({...c,[a.id]:b.target.value})),className:"jsx-a188c1cc772d63e8"}),(0,e.jsx)("button",{onClick:()=>v(a.id),className:"jsx-a188c1cc772d63e8",children:"Save"})]}),(0,e.jsxs)("td",{className:"jsx-a188c1cc772d63e8",children:["user"===a.role?(0,e.jsx)("button",{onClick:()=>u(a.id,"admin"),className:"jsx-a188c1cc772d63e8",children:"Promote to Admin"}):(0,e.jsx)("button",{onClick:()=>u(a.id,"user"),className:"jsx-a188c1cc772d63e8",children:"Demote to User"}),(0,e.jsx)("button",{onClick:()=>w(a.id),className:"jsx-a188c1cc772d63e8",children:"Delete"})]})]},a.id))})]})]}),"searches"===r&&(0,e.jsxs)("section",{className:"jsx-a188c1cc772d63e8",children:[(0,e.jsx)("h2",{className:"jsx-a188c1cc772d63e8 admin-section-title",children:"Saved search strings"}),(0,e.jsxs)("table",{className:"jsx-a188c1cc772d63e8 admin-table",children:[(0,e.jsx)("thead",{className:"jsx-a188c1cc772d63e8",children:(0,e.jsxs)("tr",{className:"jsx-a188c1cc772d63e8",children:[(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"ID"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"Title"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"Owner"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"Last updated"}),(0,e.jsx)("th",{className:"jsx-a188c1cc772d63e8",children:"Query"})]})}),(0,e.jsx)("tbody",{className:"jsx-a188c1cc772d63e8",children:c.map(a=>(0,e.jsxs)("tr",{className:"jsx-a188c1cc772d63e8",children:[(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:a.id}),(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:a.title}),(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:a.owner?.ign}),(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:new Date(a.updatedAt).toLocaleString()}),(0,e.jsx)("td",{className:"jsx-a188c1cc772d63e8",children:(0,e.jsx)("code",{className:"jsx-a188c1cc772d63e8",children:a.query})})]},a.id))})]})]})]})]}),(0,e.jsx)(g(),{id:"a188c1cc772d63e8",children:".admin-wrap.jsx-a188c1cc772d63e8{padding:12px 16px}.admin-title.jsx-a188c1cc772d63e8{font-size:42px;font-weight:800;margin:6px 0 14px}.admin-layout.jsx-a188c1cc772d63e8{display:flex;gap:16px;align-items:flex-start}.admin-sidebar.jsx-a188c1cc772d63e8{width:220px;display:flex;flex-direction:column;gap:10px;padding-top:6px}.admin-content.jsx-a188c1cc772d63e8{flex:1;min-width:0}.admin-navbtn.jsx-a188c1cc772d63e8{display:flex;align-items:center;justify-content:space-between;width:100%;border:0;border-radius:6px;padding:8px 10px;font-weight:700;color:#fff;background:#1f8a3b;cursor:pointer;box-shadow:0 1px 0 rgba(0,0,0,.25)}.admin-navbtn.jsx-a188c1cc772d63e8:hover{filter:brightness(1.05)}.admin-navbtn.active.jsx-a188c1cc772d63e8{outline:2px solid rgba(255,255,255,.18)}.admin-navbtn-caret.jsx-a188c1cc772d63e8{font-size:12px;opacity:.95}.admin-section-title.jsx-a188c1cc772d63e8{margin:0 0 10px;font-size:20px;font-weight:800}.admin-table.jsx-a188c1cc772d63e8{width:100%;border-collapse:collapse}.admin-table.jsx-a188c1cc772d63e8 th.jsx-a188c1cc772d63e8,.admin-table.jsx-a188c1cc772d63e8 td.jsx-a188c1cc772d63e8{border-bottom:1px solid rgba(255,255,255,.1);padding:8px 8px;text-align:left;vertical-align:top}.admin-table.jsx-a188c1cc772d63e8 th.jsx-a188c1cc772d63e8{font-weight:800}.admin-table.jsx-a188c1cc772d63e8 input.jsx-a188c1cc772d63e8{max-width:220px}@media(max-width:900px){.admin-layout.jsx-a188c1cc772d63e8{flex-direction:column}.admin-sidebar.jsx-a188c1cc772d63e8{width:100%;flex-direction:row;flex-wrap:wrap}.admin-navbtn.jsx-a188c1cc772d63e8{width:auto}}"})]})}async function p(a){let b=await (0,h.getServerSession)(a.req,a.res,m.N);if(!b||"admin"!==b.user.role)return{redirect:{destination:"/login",permanent:!1}};let c=await l().user.findMany({select:{id:!0,ign:!0,role:!0}}),d=(await l().entry.findMany({include:{owner:{select:{ign:!0}}},orderBy:{createdAt:"desc"}})).map(a=>({...a,createdAt:a.createdAt?.toISOString?.()??a.createdAt,updatedAt:a.updatedAt?.toISOString?.()??a.updatedAt})),e=[];try{let a=l().searchString||l().savedSearchString||l().savedSearch||l().searchStrings||l().savedSearchStrings;a?.findMany&&(e=(await a.findMany({include:{owner:{select:{ign:!0}}},orderBy:{updatedAt:"desc"}})).map(a=>({...a,createdAt:a.createdAt?.toISOString?.()??a.createdAt,updatedAt:a.updatedAt?.toISOString?.()??a.updatedAt})))}catch(a){e=[]}return{props:{users:c,entries:d,searchStrings:e}}}m=(n.then?(await n)():n)[0],d()}catch(a){d(a)}})},2768:()=>{},3139:a=>{"use strict";a.exports=import("bcryptjs")},3873:a=>{"use strict";a.exports=require("path")},4604:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{N:()=>o});var e=c(3139),f=c(5542),g=c.n(f),h=c(6382),i=c.n(h),j=c(9027),k=c(9968),l=c.n(k),m=a([e]);e=(m.then?(await m)():m)[0],(0,j.p)();let n=(0,j.K)(),o={session:{strategy:"jwt"},secret:n,providers:[i()({name:"Credentials",credentials:{ign:{label:"In-Game Name",type:"text"},password:{label:"Password",type:"password"}},async authorize(a){if(!a)return null;let b=await l().user.findUnique({where:{ign:a.ign}});return b&&await e.default.compare(a.password,b.password)?{id:b.id,ign:b.ign,role:b.role}:null}})],callbacks:{jwt:async({token:a,user:b})=>(b&&(a.id=b.id,a.ign=b.ign,a.role=b.role),a),async session({session:a,token:b}){if(!b?.id)return a??null;let c=a??{};return{...c,user:{...c.user??{},id:b.id,ign:b.ign,role:b.role}}},redirect:async({baseUrl:a})=>a},pages:{signIn:"/login"}};g()(o),d()}catch(a){d(a)}})},4722:a=>{"use strict";a.exports=require("next-auth/react")},5542:a=>{"use strict";a.exports=require("next-auth")},5806:a=>{"use strict";a.exports=require("next-auth/next")},6060:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},6095:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>g});var d=c(8732),e=c(4722);c(2768);var f=c(7878);function g({Component:a,pageProps:{session:b,...c}}){return(0,d.jsxs)(e.SessionProvider,{session:b,children:[(0,d.jsx)(f.A,{}),(0,d.jsx)(a,{...c})]})}},6330:a=>{"use strict";a.exports=require("@prisma/client")},6382:a=>{"use strict";a.exports=require("next-auth/providers/credentials")},7085:a=>{"use strict";a.exports=require("styled-jsx/style")},7878:(a,b,c)=>{"use strict";c.d(b,{A:()=>l});var d=c(8732),e=c(6761),f=c.n(e),g=c(9918),h=c.n(g),i=c(4722),j=c(2015);let k={src:"/_next/static/media/favicon.36114c8b.ico",height:32,width:32,blurWidth:0,blurHeight:0};function l(){let{data:a,status:b}=(0,i.useSession)(),[c,e]=(0,j.useState)(!1);if("loading"===b)return null;let g=a?.user?.role==="admin";return(0,d.jsx)("nav",{className:"navbar",children:(0,d.jsxs)("div",{className:"nav-inner",children:[(0,d.jsxs)(h(),{href:"/",className:"nav-logo",children:[(0,d.jsx)(f(),{src:k,alt:"Leigh Pok\xe9mon Go Community",className:"nav-favicon"}),(0,d.jsx)("span",{children:"Leigh Pokemon Go Community"})]}),(0,d.jsx)("button",{className:"nav-toggle",onClick:()=>e(!c),children:"☰"}),(0,d.jsxs)("div",{className:`nav-links ${c?"open":""}`,children:[(0,d.jsx)(h(),{href:"/",className:"nav-item",children:"Home"}),(0,d.jsx)(h(),{href:"/search-strings",className:"nav-item",children:"Search Builder"}),(0,d.jsx)(h(),{href:"/pokedex",className:"nav-item",children:"Pok\xe9dex"}),a&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(h(),{href:"/account",className:"nav-item",children:"Account"}),g&&(0,d.jsx)(h(),{href:"/admin",className:"nav-item",children:"Admin Panel"}),(0,d.jsx)("button",{className:"nav-btn",onClick:()=>(0,i.signOut)({callbackUrl:"/login"}),children:"Logout"})]}),!a&&(0,d.jsx)(h(),{href:"/login",className:"nav-item",children:"Login"})]})]})})}},8399:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>r,default:()=>n,getServerSideProps:()=>q,getStaticPaths:()=>p,getStaticProps:()=>o,handler:()=>z,reportWebVitals:()=>s,routeModule:()=>y,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>x,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>u,unstable_getStaticProps:()=>t});var e=c(3885),f=c(237),g=c(1413),h=c(3317),i=c.n(h),j=c(6095),k=c(2604),l=c(2289),m=a([k]);k=(m.then?(await m)():m)[0];let n=(0,g.M)(k,"default"),o=(0,g.M)(k,"getStaticProps"),p=(0,g.M)(k,"getStaticPaths"),q=(0,g.M)(k,"getServerSideProps"),r=(0,g.M)(k,"config"),s=(0,g.M)(k,"reportWebVitals"),t=(0,g.M)(k,"unstable_getStaticProps"),u=(0,g.M)(k,"unstable_getStaticPaths"),v=(0,g.M)(k,"unstable_getStaticParams"),w=(0,g.M)(k,"unstable_getServerProps"),x=(0,g.M)(k,"unstable_getServerSideProps"),y=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/admin",pathname:"/admin",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:j.default,Document:i()},userland:k}),z=(0,l.U)({srcPage:"/admin",config:r,userland:k,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});d()}catch(a){d(a)}})},8732:a=>{"use strict";a.exports=require("react/jsx-runtime")},9021:a=>{"use strict";a.exports=require("fs")},9027:(a,b,c)=>{"use strict";c.d(b,{p:()=>j,K:()=>k});let d=require("crypto");var e=c.n(d),f=c(9021),g=c.n(f),h=c(3873);let i=c.n(h)().join(process.cwd(),".nextauth-secret");function j(){for(let a of[process.env.NEXTAUTH_URL,process.env.SITE_URL,process.env.VERCEL_URL,process.env.DEPLOYMENT_URL,process.env.RENDER_EXTERNAL_URL]){let b=a?a.startsWith("http")?a:`https://${a}`:null;if(b)return process.env.NEXTAUTH_URL=b,b}let a=process.env.PORT||3e3,b=process.env.HOST||"localhost",c=`http://${b}:${a}`;return process.env.NEXTAUTH_URL=c,c}function k(){let a=process.env.NEXTAUTH_SECRET;if(a&&"your-secret-key-change-in-production"!==a)return a;let b=function(){try{if(g().existsSync(i)){let a=g().readFileSync(i,"utf8").trim();if(a)return a}}catch(a){console.warn("Unable to read persisted NextAuth secret",a)}return null}();if(b)return process.env.NEXTAUTH_SECRET=b,b;let c=e().randomBytes(32).toString("hex");process.env.NEXTAUTH_SECRET=c;try{g().writeFileSync(i,c,{mode:384})}catch(a){console.warn("Unable to persist NextAuth secret",a)}return c}},9968:(a,b,c)=>{"use strict";let{PrismaClient:d}=c(6330);global.prisma||(global.prisma=new d),a.exports=global.prisma}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[447,238,317,781],()=>b(b.s=8399));module.exports=c})();